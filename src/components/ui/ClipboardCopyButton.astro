---
/**
 * ClipboardCopyButton - Astro Version
 * Migrated from React to vanilla JavaScript for better performance
 */

interface Props {
  referralCode: string;
  visitUrl?: string;
  visitButtonText?: string;
}

const {
  referralCode,
  visitUrl = 'https://wealthsimple.com/invite/9C6DMQ',
  visitButtonText = 'Visit Wealthsimple.ca',
} = Astro.props;

// Generate unique ID to avoid conflicts when component is used multiple times
const uniqueId = `clipboard-${Math.random().toString(36).substring(2, 9)}`;

// Get current date formatted as "Month Year"
const now = new Date();
const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long' };
const currentDate = now.toLocaleDateString('en-US', options);
---

<div class="w-full max-w-md mx-auto rounded-2xl bg-transparent p-6" style="width: 100%; min-width: 380px;">
  <div class="text-center space-y-3" style="width: 100%;">
    <!-- Header -->
    <h3 class="text-xl font-semibold text-slate-700 dark:text-slate-200">Copy the code here:</h3>

    <!-- Referral Code Box -->
    <div
      class="border-2 border-dashed border-slate-800 dark:border-slate-300 rounded-lg px-6 py-6 bg-white dark:bg-slate-800"
      style="min-height: 100px;"
    >
      <div class="text-4xl md:text-5xl font-bold tracking-wider text-slate-800 dark:text-white">{referralCode}</div>
    </div>

    <!-- Button 1: Copy to Clipboard -->
    <button
      type="button"
      id={`${uniqueId}-copy`}
      data-code={referralCode}
      class="copy-button w-full flex items-center justify-center gap-3 rounded-xl py-4 px-8 text-lg font-bold shadow-lg transition-all duration-200 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white"
      style="min-width: 320px; height: 80px;"
    >
      <span id={`${uniqueId}-text`} style="min-width: 280px; display: inline-block;"
        >1. Copy WealthSimple Referral Code</span
      >
      <!-- Copy Icon (shown by default) -->
      <svg
        id={`${uniqueId}-copy-icon`}
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
        ></path>
      </svg>
      <!-- Check Icon (hidden by default) -->
      <svg
        id={`${uniqueId}-check-icon`}
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 hidden"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2.5"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
      </svg>
    </button>

    <!-- Button 2: Visit Wealthsimple -->
    <a
      href={visitUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="w-full flex items-center justify-center gap-2 rounded-xl py-4 px-8 text-lg font-bold shadow-lg transition-all duration-200 bg-gray-200 hover:bg-gray-300 text-slate-700"
      style="min-height: 64px;"
    >
      2. {visitButtonText}
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2.5"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M7 17L17 7M17 7H7M17 7v10"></path>
      </svg>
    </a>

    <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">
      Code Verified for {currentDate}
    </p>
  </div>
</div>

<script is:inline define:vars={{ uniqueId, referralCode }}>
  // Get DOM elements
  const copyBtn = document.getElementById(`${uniqueId}-copy`);
  const textEl = document.getElementById(`${uniqueId}-text`);
  const copyIcon = document.getElementById(`${uniqueId}-copy-icon`);
  const checkIcon = document.getElementById(`${uniqueId}-check-icon`);

  if (copyBtn && textEl && copyIcon && checkIcon) {
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(referralCode);

        // Show success state
        textEl.textContent = 'Copied!';
        copyIcon.classList.add('hidden');
        checkIcon.classList.remove('hidden');

        // Change button style to blue
        copyBtn.classList.remove('from-orange-500', 'to-orange-600', 'hover:from-orange-600', 'hover:to-orange-700');
        copyBtn.classList.add('bg-blue-600');
        copyBtn.style.background = '#2563eb'; // Force blue background

        // Reset after 2 seconds
        setTimeout(() => {
          textEl.textContent = '1. Copy WealthSimple Referral Code';
          copyIcon.classList.remove('hidden');
          checkIcon.classList.add('hidden');

          // Restore original gradient
          copyBtn.classList.remove('bg-blue-600');
          copyBtn.classList.add('from-orange-500', 'to-orange-600', 'hover:from-orange-600', 'hover:to-orange-700');
          copyBtn.style.background = ''; // Clear inline style
        }, 2000);
      } catch (err) {
        console.error('Failed to copy text:', err);
      }
    });
  }
</script>
