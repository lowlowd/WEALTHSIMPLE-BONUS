---
/**
 * CopyCodeButton - Simplified inline copy button for CTA banners
 * A compact version without the dashed code box overlay
 */

interface Props {
  referralCode: string;
  buttonClass?: string;
}

const {
  referralCode,
  buttonClass = 'px-8 py-3 text-base bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-xl shadow-lg transition-all',
} = Astro.props;

// Generate unique ID for this instance
const uniqueId = `copy-btn-${Math.random().toString(36).substring(2, 9)}`;
---

<button
  type="button"
  id={uniqueId}
  data-code={referralCode}
  class={`inline-flex items-center justify-center ${buttonClass}`}
  style="min-width: 300px; min-height: 62px;"
>
  <span id={`${uniqueId}-text`} class="flex items-center justify-center gap-2">
    Copy Code: <span class="font-mono">{referralCode}</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
      ></path>
    </svg>
  </span>
  <span id={`${uniqueId}-copied`} class="hidden items-center justify-center gap-2">
    Copied!
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2.5"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
    </svg>
  </span>
</button>

<script is:inline define:vars={{ uniqueId, referralCode }}>
  const btn = document.getElementById(uniqueId);
  const textEl = document.getElementById(`${uniqueId}-text`);
  const copiedEl = document.getElementById(`${uniqueId}-copied`);

  if (btn && textEl && copiedEl) {
    btn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(referralCode);

        // Show copied state
        textEl.classList.add('hidden');
        copiedEl.classList.remove('hidden');
        btn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
        btn.classList.add('bg-blue-600');

        // Reset after 2 seconds
        setTimeout(() => {
          textEl.classList.remove('hidden');
          copiedEl.classList.add('hidden');
          btn.classList.remove('bg-blue-600');
          btn.classList.add('bg-orange-500', 'hover:bg-orange-600');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  }
</script>
