---
import type { InferGetStaticPropsType, GetStaticPaths } from 'astro';

import Layout from '~/layouts/Layout.astro';
import Header from '~/components/widgets/Header.astro';
import Footer from '~/components/widgets/Footer.astro';
import BlogListFr from '~/components/blog/ListFr.astro';
import Headline from '~/components/blog/Headline.astro';
import Pagination from '~/components/blog/Pagination.astro';

import { headerDataFr, footerDataFr } from '~/navigation-fr';
import { fetchFrenchPosts, blogPostsPerPage } from '~/utils/blog-fr';

export const prerender = true;

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await fetchFrenchPosts();
  const pages = paginate(posts, { pageSize: blogPostsPerPage });
  return pages.filter((page) => page.params.page !== undefined);
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { page } = Astro.props as Props;
const currentPage = page.currentPage ?? 1;

const metadata = {
  title: `Blogue â€” Page ${currentPage}`,
  description: 'Guides, comparaisons et astuces pour investir avec Wealthsimple.',
  robots: { index: false, follow: true },
  openGraph: { type: 'blog' },
};

const prevUrl = currentPage === 2 ? '/fr/blogue' : page.url.prev;
---

<Layout metadata={metadata}>
  <Header {...headerDataFr} />

  <section class="px-6 sm:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-4xl">
    <Headline subtitle="Conseils, guides et astuces pour investir avec Wealthsimple!"> Blogue </Headline>
    <BlogListFr posts={page.data} />
    <Pagination prevUrl={prevUrl} nextUrl={page.url.next} />
  </section>

  <Footer {...footerDataFr} />
</Layout>
